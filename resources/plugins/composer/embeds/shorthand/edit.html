<!DOCTYPE html>
<html>
<head>
  <title>Edit Shorthand Embed</title>
  <style>
    body {
      font-family: 'Red Hat Display', sans-serif;
      padding: 16px;
    }

    label {
      display: block;
      margin-bottom: 10px;
    }

    input[type="text"] {
      width: 100%;
      padding: 8px;
      margin-top: 4px;
    }
  </style>
</head>
<body>
  <h2>Shorthand Story Button</h2>

  <label>
    Button Text:
    <input type="text" id="btn_text" value="Lire la suite" />
  </label>

  <label>
    Shorthand URL:
    <input type="text" id="url" placeholder="https://..." />
  </label>

  <label>
    Button Color:
    <input type="color" id="btn_color" value="#D51D2C" />
    <input type="text" id="btn_color_code" value="#D51D2C" />
  </label>

  <label>
    Text Color:
    <input type="color" id="text_color" value="#FFFFFF" />
    <input type="text" id="text_color_code" value="#FFFFFF" />
  </label>

  <button id="apply_btn">Apply</button>

  <!-- ✅ Load Composer SDK dynamically and wait for it -->
  <script>
    const loadComposerSdk = () => {
      const script = document.createElement('script');
      script.src = 'https://composer-tools.arc-cdn.net/core/arc-composer-sdk-v1.js';
      script.onload = () => {
        // ✅ SDK is ready
        if (typeof addEventListenerForMessage === 'function') {
          initComposerEmbed();
        } else {
          console.error('Composer SDK loaded, but functions are missing.');
        }
      };
      script.onerror = () => {
        console.error('Failed to load Composer SDK.');
      };
      document.head.appendChild(script);
    };

    const initComposerEmbed = () => {
      addEventListenerForMessage('data', (incoming) => {
        const config = incoming?.config || {};

        document.getElementById('btn_text').value = config.btn_text || 'Lire la suite';
        document.getElementById('url').value = config.url || '';
        document.getElementById('btn_color').value = config.btn_color || '#D51D2C';
        document.getElementById('btn_color_code').value = config.btn_color || '#D51D2C';
        document.getElementById('text_color').value = config.text_color || '#FFFFFF';
        document.getElementById('text_color_code').value = config.text_color || '#FFFFFF';

        document.getElementById('apply_btn').addEventListener('click', () => {
          const config = {
            btn_text: document.getElementById('btn_text').value,
            url: document.getElementById('url').value,
            btn_color: document.getElementById('btn_color_code').value,
            text_color: document.getElementById('text_color_code').value
          };

          sendMessage('data', {
            id: config.url,
            url: config.url,
            config
          });
        });
      });
    };

    // ✅ Start by loading Composer SDK
    loadComposerSdk();
  </script>
</body>
</html>
