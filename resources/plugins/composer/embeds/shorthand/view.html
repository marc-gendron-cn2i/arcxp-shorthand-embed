<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Shorthand Story Embed – Preview</title>
  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Red+Hat+Display:wght@400;700&display=swap" />
  <style>
    body { margin: 0; padding: 0; text-align: center; }
    .shorthand-button {
      font-family: 'Red Hat Display', sans-serif;
      font-size: 1rem;
      font-weight: 400;
      text-decoration: none;
      display: inline-block;
      padding: 10px 20px;
      border-radius: 4px;
      /* Colors will be set via script based on config */
    }
  </style>
</head>
<body>
  <!-- Placeholder button; will be customized by script -->
  <a id="previewButton" class="shorthand-button" href="#" target="_blank" rel="noopener noreferrer">
    View Story
  </a>

  <script>
    // Parse the configuration passed via URL (Composer attaches data in the "p" query param)
    function getConfigFromParams() {
      const params = new URLSearchParams(window.location.search);
      const payload = params.get('p');
      if (!payload) return null;
      try {
        // The payload might be URL-encoded JSON
        const data = JSON.parse(decodeURIComponent(payload));
        return data;
      } catch (e) {
        console.error("Failed to parse embed config:", e);
        return null;
      }
    }

    const embedData = getConfigFromParams();
    if (embedData) {
      const btn = document.getElementById('previewButton');
      // Set button text, link, and colors from the embed data
      btn.textContent = embedData.config.buttonText || "Découvrir le contenu";
      btn.href = embedData.url || "#";
      btn.style.backgroundColor = embedData.config.buttonColor || "#0055FF";
      btn.style.color = embedData.config.textColor || "#FFFFFF";
    }

    // Send ready handshake once content is set up
    window.parent.postMessage({ source: 'custom_embed', action: 'ready', data: { height: document.body.scrollHeight } }, '*');
  </script>
</body>
</html>

