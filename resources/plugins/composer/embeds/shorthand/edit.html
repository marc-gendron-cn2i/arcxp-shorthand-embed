<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Configure Shorthand Embed</title>
  <link href="https://fonts.googleapis.com/css2?family=Red+Hat+Display:wght@400;700&display=swap" rel="stylesheet"/>
  <style>
    body { font-family: 'Red Hat Display', sans-serif; padding: 1rem; }
    label { display: block; margin-bottom: 0.5rem; }
    input[type="text"], input[type="url"] { width: 100%; padding: 0.5rem; margin-bottom:1rem; }
    input[type="color"] { width: 3rem; height: 2rem; border: none; padding:0; vertical-align: middle; }
    .row { display: flex; align-items: center; margin-bottom:1rem; }
    .row label { flex: 1; }
    .row .picker { flex: 0; margin-left: 0.5rem; }
    button { padding: 0.5rem 1rem; margin-right:0.5rem; }
  </style>
</head>
<body>
  <h2>Shorthand Embed Settings</h2>

  <label>
    Story URL:
    <input id="url" type="url" placeholder="https://shorthand.com/your-story"/>
  </label>

  <label>
    Button Text:
    <input id="buttonText" type="text" placeholder="Read the story"/>
  </label>

  <div class="row">
    <label for="bgColor">Button Color (hex):</label>
    <input id="bgColor" class="picker" type="color"/>
    <input id="bgColorText" type="text" placeholder="#D51D2C" style="width:4rem; margin-left:0.5rem;"/>
  </div>

  <div class="row">
    <label for="textColor">Text Color (hex):</label>
    <input id="textColor" class="picker" type="color"/>
    <input id="textColorText" type="text" placeholder="#FFFFFF" style="width:4rem; margin-left:0.5rem;"/>
  </div>

  <div>
    <button id="apply">Apply</button>
    <button id="cancel">Close</button>
  </div>

  <script src="https://unpkg.com/superagent"></script>
  <script>
    let data = {};  // will hold id + config

    // 1. Read initial state from Composer
    window.addEventListener('message', e => {
      if (e.data && e.data.type === 'init') {
        data = e.data.data;
        document.getElementById('url').value        = data.id || '';
        document.getElementById('buttonText').value = data.config?.buttonText || 'Read story';
        document.getElementById('bgColor').value    = data.config?.bgColor    || '#D51D2C';
        document.getElementById('bgColorText').value= data.config?.bgColor    || '#D51D2C';
        document.getElementById('textColor').value  = data.config?.textColor  || '#FFFFFF';
        document.getElementById('textColorText').value = data.config?.textColor || '#FFFFFF';
      }
    });

    // 2. Keep color inputs & text in sync
    ['bgColor','textColor'].forEach(id=>{
      const clr = document.getElementById(id);
      const txt = document.getElementById(id+'Text');
      clr.addEventListener('input', _=> txt.value = clr.value);
      txt.addEventListener('change', _=>{
        if(/^#([0-9A-F]{3}){1,2}$/i.test(txt.value))
          clr.value = txt.value;
      });
    });

    // 3. Apply â†’ send back to Composer
    document.getElementById('apply').onclick = () => {
      data.id = document.getElementById('url').value;
      data.config = {
        buttonText: document.getElementById('buttonText').value,
        bgColor:    document.getElementById('bgColor').value,
        textColor:  document.getElementById('textColor').value
      };
      parent.postMessage({ type:'data', data }, '*');
    };

    document.getElementById('cancel').onclick = () =>
      parent.postMessage({ type:'cancel' }, '*');
  </script>
</body>
</html>
