<!DOCTYPE html>
<html>
<head>
  <title>Search Shorthand Story</title>
  <style>
    body {
      font-family: 'Red Hat Display', sans-serif;
      padding: 20px;
    }

    label {
      display: block;
      margin: 1rem 0 0.5rem;
    }

    input[type="text"] {
      width: 100%;
      padding: 8px;
    }

    .preview {
      margin: 2rem 0;
      display: flex;
      justify-content: center;
    }

    .preview a {
      font-size: 16px;
      padding: 12px 24px;
      border-radius: 8px;
      text-decoration: none;
      background-color: #D51D2C;
      color: #FFFFFF;
      white-space: nowrap;
      font-family: 'Red Hat Display', sans-serif;
    }
  </style>
</head>
<body>
  <h2>Ajouter une histoire Shorthand</h2>

  <label for="url">URL Shorthand</label>
  <input type="text" id="url" placeholder="https://..." />

  <label for="btn_text">Texte du bouton</label>
  <input type="text" id="btn_text" value="Lire la suite" />

  <div class="preview" id="preview">
    <!-- Button preview appears here -->
  </div>

  <button id="insert_btn">Insérer</button>

  <!-- ✅ Dynamic Composer SDK loading -->
  <script>
    const loadComposerSdk = () => {
      const script = document.createElement('script');
      script.src = 'https://composer-tools.arc-cdn.net/core/arc-composer-sdk-v1.js';
      script.onload = () => {
        if (typeof sendMessage === 'function') {
          initSearchPanel();
        } else {
          console.error('Composer SDK functions are missing.');
        }
      };
      script.onerror = () => {
        console.error('Failed to load Composer SDK.');
      };
      document.head.appendChild(script);
    };

    const initSearchPanel = () => {
      const urlInput = document.getElementById('url');
      const textInput = document.getElementById('btn_text');
      const preview = document.getElementById('preview');
      const insertBtn = document.getElementById('insert_btn');

      // Preview on input
      const updatePreview = () => {
        preview.innerHTML = '';

        const a = document.createElement('a');
        a.href = urlInput.value || '#';
        a.target = '_blank';
        a.innerText = textInput.value || 'Lire la suite';
        a.style.backgroundColor = '#D51D2C';
        a.style.color = '#FFFFFF';

        preview.appendChild(a);
      };

      urlInput.addEventListener('input', updatePreview);
      textInput.addEventListener('input', updatePreview);

      insertBtn.addEventListener('click', () => {
        const config = {
          url: urlInput.value,
          btn_text: textInput.value,
          btn_color: '#D51D2C',
          text_color: '#FFFFFF'
        };

        sendMessage('data', {
          id: config.url,
          url: config.url,
          config
        });
      });

      updatePreview(); // Show preview on load
    };

    loadComposerSdk();
  </script>
</body>
</html>
