<script>
  // Récupérer la clé ?k= utilisée pour identifier l'instance de l'embed
  function getKeyFromUrl() {
    const params = new URLSearchParams(window.location.search);
    return params.get("k") || "";
  }

  // Fonction pour envoyer des messages à Arc Composer
  function sendMessage(action, data) {
    window.parent.postMessage(
      JSON.stringify({
        source: "custom_embed",
        action,
        data,
        key: getKeyFromUrl()
      }),
      "*"
    );
  }

  const config = window.PowerUp?.embed?.config || {};

  const btn = document.getElementById('shorthandBtn');
  btn.textContent = config.buttonText || 'Voir le contenu';
  btn.style.backgroundColor = config.bgColor || '#D51D2C';
  btn.style.color = config.textColor || '#FFFFFF';

  // Envoyer un message au parent au clic sur le bouton
  btn.onclick = () => {
    if (config.shorthandUrl) {
      sendMessage("click", {
        id: "shorthand-button",
        url: config.shorthandUrl,
        config
      });
    } else {
      alert('Aucune URL Shorthand fournie.');
    }
  };

  // Envoyer la hauteur de l'iframe à Composer
  window.addEventListener("load", () => {
    const height = document.body.scrollHeight;
    sendMessage("height", { height });
  });
</script>
